pkgname=onthespot-git
pkgver=0.7.0
_branch="main"
pkgrel=1
pkgdesc="Qt based music downloader written in python"
arch=('any')
url="https://github.com/justin025/onthespot"
license=('GPLv2')
depends=('ffmpeg' 'python-requests' 'python_urllib3' 'python-mutagen' 'python-pyqt6' 'python-pillow' 'python-pyperclip' 'python-librespot' 'python-googletrans')
conflicts=('onthespot')
provides=('onthespot')
makedepends=('python-build' 'python-installer' 'python-setuptools' 'python-wheel')
optdepends=()
source=("https://github.com/justin025/onthespot/archive/refs/heads/$_branch.zip")
sha256sums=(SKIP)

build() {
  cd "onthespot-$_branch"
  python -m build --wheel --no-isolation
}

pkgver() {
  grep "self.version = *" "$PWD/onthespot-$_branch/src/onthespot/otsconfig.py" | sed 's/self.version = //g;s/ //g'
}

package() {
  cd "onthespot-$_branch"
  python -m installer --destdir="$pkgdir" dist/*.whl
  install -dm 755 "$pkgdir/usr/share/applications"
  install -dm 755 "$pkgdir/usr/share/icons/hicolor/"{256x256,scalable}"/apps/"
  install -Dm 644 LICENSE -t "$pkgdir/usr/share/licenses/$pkgname/"
  install -Dm 644 "src/onthespot/resources/org.eu.casualsnek.onthespot.desktop" "$pkgdir/usr/share/applications/"
  install -Dm 644 "src/onthespot/resources/icons/onthespot.svg" "$pkgdir/usr/share/icons/hicolor/scalable/apps/onthespot.svg"
  install -Dm 644 "src/onthespot/resources/icons/onthespot.png" "$pkgdir/usr/share/icons/hicolor/256x256/apps/onthespot.png"
}
